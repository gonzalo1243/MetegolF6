<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios - Metegol Futbol 5</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
</head>
<body>

<div class="container mt-5">
    <h2>Gestión de Usuarios</h2>
    
    <form id="usuarioForm">
        <div class="mb-3">
            <label for="nombre" class="form-label">Nombre:</label>
            <input type="text" id="nombre" name="nombre" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="celular" class="form-label">Celular:</label>
            <input type="tel" id="celular" name="celular" class="form-control" required>
        </div>

        <div class="mb-3">
            <label for="accion" class="form-label">Acción:</label>
            <select id="accion" name="accion" class="form-control" required>
                <option value="">Seleccione una opción</option>
                <option value="alta">Alta</option>
                <option value="baja">Baja</option>
                <option value="modificar">Modificar</option>
            </select>
        </div>

        <button type="submit" class="btn btn-primary">Ejecutar Acción</button>
    </form>
</div>

<!-- Scripts -->
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
    document.getElementById("usuarioForm").addEventListener("submit", function(event) {
        event.preventDefault();

        const nombre = document.getElementById('nombre').value.trim();
        const celular = document.getElementById('celular').value.trim();
        const accion = document.getElementById('accion').value;

        // Verificar si el nombre está vacío antes de ejecutar la acción
        if (!nombre) {
            Swal.fire({
                title: 'Error',
                text: 'Debe seleccionar un cliente para dar de alta.',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
            return;
        }

        // Verificar si faltan otros campos
        if (!celular || !accion) {
            Swal.fire({
                title: 'Error',
                text: 'Debe completar todos los campos antes de continuar.',
                icon: 'error',
                confirmButtonText: 'Aceptar'
            });
            return;
        }

        let confirmacionTexto = '';
        let iconoAlerta = 'warning';

        if (accion === 'baja') {
            confirmacionTexto = `¿Estás seguro de que deseas eliminar a ${nombre}? Esta acción no se puede deshacer.`;
        } else if (accion === 'modificar') {
            confirmacionTexto = `¿Confirmas la modificación de los datos de ${nombre}?`;
        } else if (accion === 'alta') {
            confirmacionTexto = `¿Deseas dar de alta al usuario ${nombre}?`;
        }

        Swal.fire({
            title: 'Confirmación',
            text: confirmacionTexto,
            icon: iconoAlerta,
            showCancelButton: true,
            confirmButtonText: 'Sí, continuar',
            cancelButtonText: 'Cancelar'
        }).then((result) => {
            if (result.isConfirmed) {
                $.ajax({
                    url: 'usuarios.php',
                    type: 'POST',
                    data: { nombre, celular, accion },
                    success: function(response) {
                        let respuesta = response.trim();
                        let mensajeFinal = respuesta || 'Operación realizada con éxito.';

                        Swal.fire({
                            title: 'Éxito',
                            text: mensajeFinal,
                            icon: 'success',
                            confirmButtonText: 'Aceptar'
                        }).then(() => {
                            window.location.href = `informe_usuario.html?nombre=${encodeURIComponent(nombre)}&accion=${encodeURIComponent(accion)}`;
                        });
                    },
                    error: function() {
                        Swal.fire({
                            title: 'Error',
                            text: 'Hubo un problema con la acción. Inténtelo de nuevo.',
                            icon: 'error',
                            confirmButtonText: 'Aceptar'
                        });
                    }
                });
            }
        });
    });
</script>

</body>
</html>